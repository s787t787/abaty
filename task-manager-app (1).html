<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <!-- PWA Meta Tags for iPhone -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ù‡Ø§Ù…">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#08080d">
    <meta name="application-name" content="Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ù‡Ø§Ù…">
    
    <!-- App Icons for iPhone -->
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%236366f1' width='100' height='100' rx='20'/><text x='50' y='65' font-size='50' text-anchor='middle' fill='white'>ğŸ§ </text></svg>">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%236366f1' width='100' height='100' rx='20'/><text x='50' y='65' font-size='50' text-anchor='middle' fill='white'>ğŸ§ </text></svg>">
    
    <!-- Splash Screens for iPhone -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <title>Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ù‡Ø§Ù…</title>
    
    <style>
        :root {
            --bg-dark: #08080d;
            --bg-card: #111118;
            --bg-input: #1a1a24;
            --bg-hover: #222230;
            --accent-primary: #6366f1;
            --accent-glow: rgba(99,102,241,0.25);
            --urgent-important: #ef4444;
            --important: #3b82f6;
            --urgent: #f59e0b;
            --neither: #6b7280;
            --success: #10b981;
            --financial: #8b5cf6;
            --suggestion: #06b6d4;
            --text-primary: #f5f5f7;
            --text-secondary: #a0a0b0;
            --text-muted: #606070;
            --border: rgba(255,255,255,0.06);
            --border-light: rgba(255,255,255,0.12);
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
            --safe-left: env(safe-area-inset-left);
            --safe-right: env(safe-area-inset-right);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
        }

        html {
            scroll-behavior: smooth;
            height: -webkit-fill-available;
        }

        body {
            font-family: 'SF Pro Arabic', 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            min-height: -webkit-fill-available;
            line-height: 1.6;
            padding-top: var(--safe-top);
            padding-bottom: var(--safe-bottom);
            padding-left: var(--safe-left);
            padding-right: var(--safe-right);
            overscroll-behavior: none;
            -webkit-user-select: none;
            user-select: none;
        }

        /* Install Prompt */
        .install-prompt {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, var(--bg-card), transparent);
            padding: 20px;
            padding-bottom: calc(20px + var(--safe-bottom));
            z-index: 1000;
            display: none;
        }

        .install-prompt.show {
            display: block;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }

        .install-card {
            background: var(--bg-card);
            border: 1px solid var(--border-light);
            border-radius: 16px;
            padding: 16px;
            text-align: center;
        }

        .install-card h3 {
            font-size: 1rem;
            margin-bottom: 8px;
        }

        .install-card p {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }

        .install-steps {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 12px;
        }

        .install-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .install-step .icon {
            font-size: 1.5rem;
        }

        .install-step .label {
            font-size: 0.7rem;
            color: var(--text-muted);
        }

        .dismiss-install {
            background: var(--accent-primary);
            border: none;
            border-radius: 10px;
            padding: 12px 24px;
            color: white;
            font-family: inherit;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 16px;
            padding-bottom: calc(90px + var(--safe-bottom));
        }

        /* ============ FINANCIAL CARDS ============ */
        .financial-cards {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 14px;
        }

        .fin-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 12px 8px;
            text-align: center;
            transition: transform 0.2s;
        }

        .fin-card:active {
            transform: scale(0.97);
        }

        .fin-card.daily { border-color: rgba(16,185,129,0.3); }
        .fin-card.monthly { border-color: rgba(139,92,246,0.3); }
        .fin-card.total { border-color: rgba(245,158,11,0.3); }

        .fin-card-icon {
            font-size: 1.2rem;
            margin-bottom: 4px;
        }

        .fin-card-label {
            font-size: 0.6rem;
            color: var(--text-muted);
            margin-bottom: 2px;
        }

        .fin-card-amount {
            font-size: 0.95rem;
            font-weight: 800;
        }

        .fin-card.daily .fin-card-amount { color: var(--success); }
        .fin-card.monthly .fin-card-amount { color: var(--financial); }
        .fin-card.total .fin-card-amount { color: var(--urgent); }

        .fin-card-sub {
            font-size: 0.55rem;
            color: var(--text-muted);
        }

        /* ============ URGENT BANNER ============ */
        .urgent-banner {
            display: none;
            background: linear-gradient(135deg, rgba(239,68,68,0.12), rgba(245,158,11,0.08));
            border: 1px solid rgba(239,68,68,0.25);
            border-radius: 14px;
            padding: 12px;
            margin-bottom: 14px;
        }

        .urgent-banner.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .urgent-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .urgent-header h3 {
            font-size: 0.8rem;
            color: var(--urgent-important);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .bell {
            animation: ring 1s infinite;
        }

        @keyframes ring {
            0%, 100% { transform: rotate(0); }
            25% { transform: rotate(10deg); }
            75% { transform: rotate(-10deg); }
        }

        .dismiss-btn {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 1.1rem;
            cursor: pointer;
            padding: 4px;
        }

        .urgent-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .urgent-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 10px;
            background: rgba(0,0,0,0.25);
            border-radius: 8px;
            font-size: 0.8rem;
        }

        .urgent-time {
            background: var(--urgent-important);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 700;
            white-space: nowrap;
        }

        .urgent-text {
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* ============ AI SUGGESTIONS ============ */
        .suggestions-card {
            background: linear-gradient(135deg, rgba(6,182,212,0.1), rgba(99,102,241,0.08));
            border: 1px solid rgba(6,182,212,0.25);
            border-radius: 14px;
            padding: 12px;
            margin-bottom: 14px;
            display: none;
        }

        .suggestions-card.show {
            display: block;
        }

        .suggestions-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .suggestions-header h3 {
            font-size: 0.8rem;
            color: var(--suggestion);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .refresh-btn {
            background: none;
            border: none;
            color: var(--suggestion);
            font-size: 1rem;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .refresh-btn:active {
            transform: rotate(180deg);
        }

        .suggestion-item {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            padding: 8px 10px;
            background: rgba(0,0,0,0.25);
            border-radius: 8px;
            font-size: 0.75rem;
            margin-bottom: 6px;
        }

        .suggestion-item:last-child {
            margin-bottom: 0;
        }

        .suggestion-icon {
            font-size: 0.9rem;
        }

        .suggestion-content {
            flex: 1;
        }

        .suggestion-title {
            font-weight: 600;
            color: var(--suggestion);
            margin-bottom: 2px;
        }

        .suggestion-desc {
            color: var(--text-secondary);
            font-size: 0.7rem;
            line-height: 1.4;
        }

        /* ============ HEADER ============ */
        .app-header {
            text-align: center;
            padding: 16px 0;
        }

        .app-header h1 {
            font-size: 1.4rem;
            font-weight: 800;
            background: linear-gradient(135deg, #fff 0%, var(--accent-primary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .app-header p {
            color: var(--text-muted);
            font-size: 0.8rem;
            margin-top: 2px;
        }

        /* ============ PHASE TABS ============ */
        .phase-tabs {
            display: flex;
            gap: 6px;
            margin-bottom: 14px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }

        .phase-tabs::-webkit-scrollbar {
            display: none;
        }

        .phase-tab {
            flex: 1;
            padding: 11px 12px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 11px;
            color: var(--text-muted);
            font-family: inherit;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            white-space: nowrap;
        }

        .phase-tab.active {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            color: white;
        }

        .phase-tab.completed {
            border-color: var(--success);
            color: var(--success);
        }

        .phase-tab:active {
            transform: scale(0.97);
        }

        /* ============ PHASES ============ */
        .phase {
            display: none;
        }

        .phase.active {
            display: block;
            animation: fadeIn 0.25s ease;
        }

        /* ============ CARD ============ */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 18px;
            padding: 16px;
            margin-bottom: 12px;
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .card-icon {
            width: 38px;
            height: 38px;
            background: var(--accent-glow);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
        }

        .card-title {
            font-size: 0.95rem;
            font-weight: 700;
        }

        .card-subtitle {
            font-size: 0.7rem;
            color: var(--text-muted);
        }

        /* ============ PROGRESS ============ */
        .progress-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            position: relative;
        }

        .progress-row::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--border);
            transform: translateY(-50%);
        }

        .progress-fill {
            position: absolute;
            top: 50%;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--accent-primary), var(--success));
            transform: translateY(-50%);
            transition: width 0.4s ease;
            z-index: 1;
        }

        .progress-dot {
            width: 28px;
            height: 28px;
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            position: relative;
            z-index: 2;
            transition: all 0.3s;
        }

        .progress-dot.active {
            border-color: var(--accent-primary);
            background: var(--accent-primary);
            box-shadow: 0 0 10px var(--accent-glow);
        }

        .progress-dot.done {
            border-color: var(--success);
            background: var(--success);
        }

        /* ============ CHAT ============ */
        .chat-area {
            background: var(--bg-input);
            border-radius: 12px;
            padding: 10px;
            max-height: 180px;
            overflow-y: auto;
            margin-bottom: 10px;
            -webkit-overflow-scrolling: touch;
        }

        .chat-msg {
            margin-bottom: 8px;
        }

        .chat-msg.bot {
            display: flex;
            gap: 6px;
        }

        .bot-avatar {
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, var(--accent-primary), #8b5cf6);
            border-radius: 7px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.65rem;
            flex-shrink: 0;
        }

        .msg-bubble {
            background: var(--bg-card);
            padding: 8px 10px;
            border-radius: 10px;
            border-top-right-radius: 3px;
            max-width: 85%;
            font-size: 0.8rem;
            line-height: 1.4;
        }

        .chat-msg.user .msg-bubble {
            background: var(--accent-primary);
            margin-right: auto;
            margin-left: 30px;
            border-top-right-radius: 10px;
            border-top-left-radius: 3px;
        }

        .typing {
            display: flex;
            gap: 3px;
            padding: 3px 0;
        }

        .typing span {
            width: 5px;
            height: 5px;
            background: var(--text-muted);
            border-radius: 50%;
            animation: bounce 1.4s infinite;
        }

        .typing span:nth-child(2) { animation-delay: 0.2s; }
        .typing span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes bounce {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-3px); }
        }

        /* ============ TASK FORM ============ */
        .task-form {
            background: var(--bg-input);
            border-radius: 12px;
            padding: 12px;
        }

        .form-row {
            display: flex;
            gap: 6px;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }

        .form-row:last-child {
            margin-bottom: 0;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }

        .form-group.flex-1 {
            flex: 1;
            min-width: 100%;
        }

        .form-group.third {
            flex: 1;
            min-width: calc(33.33% - 4px);
        }

        .form-group label {
            font-size: 0.65rem;
            color: var(--text-muted);
        }

        .form-input {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 10px;
            color: var(--text-primary);
            font-family: inherit;
            font-size: 0.85rem;
            -webkit-appearance: none;
            appearance: none;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .form-input::placeholder {
            color: var(--text-muted);
        }

        .form-input.small {
            padding: 9px 6px;
            font-size: 0.8rem;
            text-align: center;
        }

        select.form-input {
            cursor: pointer;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23606070' viewBox='0 0 24 24'%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: left 8px center;
            background-size: 16px;
            padding-left: 28px;
        }

        .add-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, var(--accent-primary), #8b5cf6);
            border: none;
            border-radius: 10px;
            color: white;
            font-family: inherit;
            font-size: 0.9rem;
            font-weight: 700;
            cursor: pointer;
            margin-top: 4px;
        }

        .add-btn:active {
            transform: scale(0.98);
        }

        .next-cat-btn {
            width: 100%;
            padding: 10px;
            background: transparent;
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-muted);
            font-family: inherit;
            font-size: 0.8rem;
            cursor: pointer;
            margin-top: 8px;
        }

        .next-cat-btn:active {
            border-color: var(--success);
            color: var(--success);
        }

        /* ============ TASK SUMMARY ============ */
        .task-summary {
            background: var(--bg-input);
            border-radius: 10px;
            padding: 10px;
            margin-top: 10px;
            display: none;
        }

        .task-summary.show {
            display: block;
        }

        .summary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .summary-header h4 {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .task-badge {
            background: var(--accent-primary);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.65rem;
        }

        .task-list {
            max-height: 100px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .task-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 0;
            border-bottom: 1px solid var(--border);
            font-size: 0.75rem;
        }

        .task-item:last-child {
            border-bottom: none;
        }

        .task-dot {
            width: 4px;
            height: 4px;
            background: var(--accent-primary);
            border-radius: 50%;
            flex-shrink: 0;
        }

        .task-content {
            flex: 1;
            min-width: 0;
        }

        .task-text {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .task-meta {
            display: flex;
            gap: 6px;
            font-size: 0.65rem;
            color: var(--text-muted);
            margin-top: 1px;
        }

        .task-meta .amount {
            color: var(--financial);
        }

        /* ============ MATRIX ============ */
        .matrix-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .quadrant {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
        }

        .quadrant.q1 { border-color: rgba(239,68,68,0.3); }
        .quadrant.q2 { border-color: rgba(59,130,246,0.3); }
        .quadrant.q3 { border-color: rgba(245,158,11,0.3); }
        .quadrant.q4 { border-color: rgba(107,114,128,0.3); }

        .quad-header {
            padding: 10px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .quad-title {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .quad-icon {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }

        .q1 .quad-icon { background: rgba(239,68,68,0.15); }
        .q2 .quad-icon { background: rgba(59,130,246,0.15); }
        .q3 .quad-icon { background: rgba(245,158,11,0.15); }
        .q4 .quad-icon { background: rgba(107,114,128,0.15); }

        .quad-label {
            display: flex;
            flex-direction: column;
        }

        .quad-name {
            font-weight: 700;
            font-size: 0.7rem;
        }

        .q1 .quad-name { color: var(--urgent-important); }
        .q2 .quad-name { color: var(--important); }
        .q3 .quad-name { color: var(--urgent); }
        .q4 .quad-name { color: var(--neither); }

        .quad-action {
            font-size: 0.55rem;
            color: var(--text-muted);
        }

        .quad-count {
            background: var(--bg-input);
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 0.65rem;
        }

        .quad-tasks {
            padding: 8px;
            max-height: 130px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .quad-task {
            padding: 6px 0;
            border-bottom: 1px solid var(--border);
            font-size: 0.7rem;
        }

        .quad-task:last-child {
            border-bottom: none;
        }

        .quad-task-text {
            margin-bottom: 1px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .quad-task-meta {
            font-size: 0.6rem;
            color: var(--text-muted);
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .quad-task-meta .amount {
            color: var(--financial);
        }

        .empty-quad {
            text-align: center;
            padding: 12px;
            color: var(--text-muted);
            font-size: 0.7rem;
        }

        /* ============ SCHEDULE ============ */
        .setup-section {
            background: var(--bg-input);
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 10px;
        }

        .setup-section h4 {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .event-row {
            display: flex;
            gap: 5px;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }

        .event-row .form-input {
            padding: 8px;
            font-size: 0.75rem;
        }

        .event-row .time-input {
            width: 70px;
            text-align: center;
        }

        .event-row .name-input {
            flex: 1;
            min-width: 100px;
        }

        .event-row .add-event-btn {
            padding: 8px 12px;
            background: var(--accent-primary);
            border: none;
            border-radius: 6px;
            color: white;
            font-size: 0.8rem;
            cursor: pointer;
        }

        .event-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }

        .event-tag {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 5px 8px;
            background: var(--bg-card);
            border-radius: 6px;
            font-size: 0.7rem;
        }

        .remove-tag {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 0.85rem;
            padding: 0;
        }

        .notif-row {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .notif-row label {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .notif-row select {
            padding: 7px 8px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            font-family: inherit;
            font-size: 0.75rem;
        }

        .toggle-wrapper {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            background: var(--bg-card);
            border-radius: 6px;
            font-size: 0.75rem;
        }

        .toggle-wrapper input {
            display: none;
        }

        .toggle-track {
            width: 30px;
            height: 16px;
            background: var(--border);
            border-radius: 8px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s;
        }

        .toggle-wrapper input:checked + .toggle-track {
            background: var(--success);
        }

        .toggle-track::after {
            content: '';
            position: absolute;
            top: 2px;
            right: 2px;
            width: 12px;
            height: 12px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .toggle-wrapper input:checked + .toggle-track::after {
            right: 14px;
        }

        .test-btn {
            padding: 6px 10px;
            background: transparent;
            border: 1px solid var(--border);
            border-radius: 5px;
            color: var(--text-secondary);
            font-size: 0.7rem;
            cursor: pointer;
        }

        .generate-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, var(--accent-primary), #8b5cf6);
            border: none;
            border-radius: 12px;
            color: white;
            font-family: inherit;
            font-size: 0.95rem;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .generate-btn:active {
            transform: scale(0.98);
        }

        .schedule-output {
            display: none;
        }

        .schedule-output.show {
            display: block;
        }

        .schedule-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .schedule-header h3 {
            font-size: 0.9rem;
        }

        .schedule-actions {
            display: flex;
            gap: 5px;
        }

        .schedule-btn {
            padding: 7px 10px;
            border-radius: 6px;
            font-family: inherit;
            font-size: 0.75rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .schedule-btn.primary {
            background: var(--accent-primary);
            border: none;
            color: white;
        }

        .schedule-btn.secondary {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
        }

        .timeline {
            background: var(--bg-input);
            border-radius: 12px;
            padding: 12px;
        }

        .time-block {
            display: flex;
            gap: 8px;
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
        }

        .time-block:last-child {
            border-bottom: none;
        }

        .block-time {
            width: 40px;
            font-size: 0.7rem;
            color: var(--text-muted);
            flex-shrink: 0;
        }

        .block-dot {
            width: 7px;
            height: 7px;
            border-radius: 50%;
            margin-top: 3px;
            flex-shrink: 0;
        }

        .block-content {
            flex: 1;
            min-width: 0;
        }

        .block-title {
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 1px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .block-meta {
            font-size: 0.65rem;
            color: var(--text-muted);
            display: flex;
            gap: 6px;
        }

        .block-meta .amount {
            color: var(--financial);
        }

        .time-block.deep-work .block-dot { background: var(--important); }
        .time-block.deep-work .block-title { color: var(--important); }

        .time-block.urgent .block-dot { background: var(--urgent-important); }
        .time-block.urgent .block-title { color: var(--urgent-important); }

        .time-block.fixed .block-dot { background: var(--text-muted); }

        .time-block.buffer .block-dot { 
            background: transparent;
            border: 2px solid var(--text-muted);
            width: 5px;
            height: 5px;
        }
        .time-block.buffer .block-title { color: var(--text-muted); font-weight: 400; }

        .time-block.break .block-dot { background: var(--success); }
        .time-block.break .block-title { color: var(--success); }

        /* ============ NAV BUTTONS ============ */
        .nav-buttons {
            display: flex;
            gap: 8px;
            margin-top: 14px;
        }

        .nav-btn {
            flex: 1;
            padding: 12px;
            border-radius: 10px;
            font-family: inherit;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .nav-btn.primary {
            background: linear-gradient(135deg, var(--accent-primary), #8b5cf6);
            border: none;
            color: white;
        }

        .nav-btn.secondary {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
        }

        .nav-btn:active {
            transform: scale(0.98);
        }

        .nav-btn:disabled {
            opacity: 0.4;
        }

        /* ============ EXPORT FAB ============ */
        .export-fab {
            position: fixed;
            bottom: calc(20px + var(--safe-bottom));
            left: 20px;
            width: 52px;
            height: 52px;
            background: linear-gradient(135deg, var(--financial), #7c3aed);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(139,92,246,0.4);
            z-index: 50;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .export-fab:active {
            transform: scale(0.95);
        }

        /* ============ MODAL ============ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.75);
            display: none;
            align-items: flex-end;
            justify-content: center;
            z-index: 100;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal-content {
            background: var(--bg-card);
            border-radius: 20px 20px 0 0;
            padding: 20px;
            padding-bottom: calc(20px + var(--safe-bottom));
            width: 100%;
            max-width: 500px;
            max-height: 70vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 14px;
        }

        .modal-header h3 {
            font-size: 1rem;
        }

        .close-modal {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 1.3rem;
            cursor: pointer;
        }

        .export-options {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .export-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 14px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text-primary);
            font-family: inherit;
            font-size: 0.85rem;
            cursor: pointer;
            text-align: right;
        }

        .export-btn:active {
            border-color: var(--accent-primary);
        }

        .export-btn .icon {
            font-size: 1.3rem;
        }

        .export-btn .info {
            flex: 1;
        }

        .export-btn .title {
            font-weight: 600;
        }

        .export-btn .desc {
            font-size: 0.7rem;
            color: var(--text-muted);
        }

        /* ============ NOTIFICATION POPUP ============ */
        .notif-popup {
            position: fixed;
            top: calc(12px + var(--safe-top));
            left: 12px;
            right: 12px;
            background: linear-gradient(135deg, var(--urgent-important), #dc2626);
            padding: 12px 14px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(239,68,68,0.4);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 8px;
            transform: translateY(-120%);
            transition: transform 0.3s ease;
        }

        .notif-popup.show {
            transform: translateY(0);
        }

        .notif-popup .icon {
            font-size: 1.2rem;
        }

        .notif-popup .content {
            flex: 1;
        }

        .notif-popup .title {
            font-weight: 700;
            font-size: 0.85rem;
        }

        .notif-popup .body {
            font-size: 0.75rem;
            opacity: 0.9;
        }

        .notif-popup .close {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <!-- Install Prompt for iPhone -->
    <div class="install-prompt" id="installPrompt">
        <div class="install-card">
            <h3>ğŸ“² ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</h3>
            <p>Ø£Ø¶Ù Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¥Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹</p>
            <div class="install-steps">
                <div class="install-step">
                    <span class="icon">â¬†ï¸</span>
                    <span class="label">Ø§Ø¶ØºØ· Ù…Ø´Ø§Ø±ÙƒØ©</span>
                </div>
                <div class="install-step">
                    <span class="icon">â•</span>
                    <span class="label">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø´Ø§Ø´Ø©</span>
                </div>
            </div>
            <button class="dismiss-install" onclick="dismissInstall()">ÙÙ‡Ù…Øª</button>
        </div>
    </div>

    <!-- Notification Popup -->
    <div class="notif-popup" id="notifPopup">
        <span class="icon">ğŸ””</span>
        <div class="content">
            <div class="title" id="notifTitle">ØªØ°ÙƒÙŠØ±</div>
            <div class="body" id="notifBody">Ø§Ù„Ù…Ù‡Ù…Ø©</div>
        </div>
        <button class="close" onclick="hideNotif()">Ã—</button>
    </div>

    <!-- Export Modal -->
    <div class="modal-overlay" id="exportModal" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3>ğŸ“¤ ØªØµØ¯ÙŠØ±</h3>
                <button class="close-modal" onclick="closeExportModal()">Ã—</button>
            </div>
            <div class="export-options">
                <button class="export-btn" onclick="exportFinancialCSV()">
                    <span class="icon">ğŸ“Š</span>
                    <div class="info">
                        <div class="title">ØªÙ‚Ø±ÙŠØ± Ù…Ø§Ù„ÙŠ (CSV)</div>
                        <div class="desc">Ù„Ù„Ù€ Excel Ù…Ø¹ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª</div>
                    </div>
                </button>
                <button class="export-btn" onclick="exportScheduleText()">
                    <span class="icon">ğŸ“…</span>
                    <div class="info">
                        <div class="title">Ù†Ø³Ø® Ø§Ù„Ø¬Ø¯ÙˆÙ„</div>
                        <div class="desc">Ù†Øµ Ù‚Ø§Ø¨Ù„ Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ©</div>
                    </div>
                </button>
                <button class="export-btn" onclick="exportFullReport()">
                    <span class="icon">ğŸ“‹</span>
                    <div class="info">
                        <div class="title">ØªÙ‚Ø±ÙŠØ± Ø´Ø§Ù…Ù„</div>
                        <div class="desc">ÙƒÙ„ Ø´ÙŠØ¡ ÙÙŠ Ù…ÙƒØ§Ù† ÙˆØ§Ø­Ø¯</div>
                    </div>
                </button>
                <button class="export-btn" onclick="shareReport()">
                    <span class="icon">ğŸ“±</span>
                    <div class="info">
                        <div class="title">Ù…Ø´Ø§Ø±ÙƒØ©</div>
                        <div class="desc">Ø¹Ø¨Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰</div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Export FAB -->
    <button class="export-fab" onclick="openExportModal()">ğŸ“¤</button>

    <div class="container">
        <!-- Financial Cards -->
        <div class="financial-cards">
            <div class="fin-card daily">
                <div class="fin-card-icon">ğŸ“…</div>
                <div class="fin-card-label">Ø§Ù„ÙŠÙˆÙ…</div>
                <div class="fin-card-amount" id="dailyAmount">0</div>
                <div class="fin-card-sub">Ø±.Ø³</div>
            </div>
            <div class="fin-card monthly">
                <div class="fin-card-icon">ğŸ“†</div>
                <div class="fin-card-label" id="monthLabel">Ø§Ù„Ø´Ù‡Ø±</div>
                <div class="fin-card-amount" id="monthlyAmount">0</div>
                <div class="fin-card-sub">Ø±.Ø³</div>
            </div>
            <div class="fin-card total">
                <div class="fin-card-icon">ğŸ’°</div>
                <div class="fin-card-label">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div>
                <div class="fin-card-amount" id="totalAmount">0</div>
                <div class="fin-card-sub">Ø±.Ø³</div>
            </div>
        </div>

        <!-- Urgent Banner -->
        <div class="urgent-banner" id="urgentBanner">
            <div class="urgent-header">
                <h3><span class="bell">ğŸ””</span> Ù…Ù‡Ø§Ù… Ø¹Ø§Ø¬Ù„Ø©</h3>
                <button class="dismiss-btn" onclick="dismissBanner()">Ã—</button>
            </div>
            <div class="urgent-list" id="urgentList"></div>
        </div>

        <!-- Suggestions -->
        <div class="suggestions-card" id="suggestionsCard">
            <div class="suggestions-header">
                <h3>ğŸ’¡ Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª</h3>
                <button class="refresh-btn" onclick="generateSuggestions()">ğŸ”„</button>
            </div>
            <div id="suggestionsList"></div>
        </div>

        <!-- Header -->
        <header class="app-header">
            <h1>ğŸ§  Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ù‡Ø§Ù…</h1>
            <p>ØªÙØ±ÙŠØº â†’ ØªØµÙ†ÙŠÙ â†’ Ø¬Ø¯ÙˆÙ„Ø©</p>
        </header>

        <!-- Phase Tabs -->
        <nav class="phase-tabs">
            <button class="phase-tab active" onclick="goToPhase(1)" id="tab1">â‘  ØªÙØ±ÙŠØº</button>
            <button class="phase-tab" onclick="goToPhase(2)" id="tab2">â‘¡ Ø£ÙˆÙ„ÙˆÙŠØ§Øª</button>
            <button class="phase-tab" onclick="goToPhase(3)" id="tab3">â‘¢ Ø¬Ø¯ÙˆÙ„Ø©</button>
        </nav>

        <!-- PHASE 1 -->
        <div class="phase active" id="phase1">
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">ğŸ’­</div>
                    <div>
                        <div class="card-title">Ù…Ø³ØªÙ…Ø¹ Ø§Ù„Ù…Ù‡Ø§Ù…</div>
                        <div class="card-subtitle">ÙØ±Ù‘Øº Ø°Ù‡Ù†Ùƒ</div>
                    </div>
                </div>

                <div class="progress-row">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    <div class="progress-dot active">ğŸ’¼</div>
                    <div class="progress-dot">ğŸš€</div>
                    <div class="progress-dot">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§</div>
                    <div class="progress-dot">ğŸ’°</div>
                    <div class="progress-dot">ğŸ“š</div>
                </div>

                <div class="chat-area" id="chatArea"></div>

                <div class="task-form">
                    <div class="form-row">
                        <div class="form-group flex-1">
                            <label>Ø§Ù„Ù…Ù‡Ù…Ø©</label>
                            <input type="text" class="form-input" id="taskText" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù…Ù‡Ù…Ø©...">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group third">
                            <label>Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                            <input type="date" class="form-input small" id="taskDate">
                        </div>
                        <div class="form-group third">
                            <label>Ø§Ù„ÙˆÙ‚Øª</label>
                            <input type="time" class="form-input small" id="taskTime">
                        </div>
                        <div class="form-group third">
                            <label>Ø§Ù„Ù…Ø¯Ø©</label>
                            <select class="form-input small" id="taskDuration">
                                <option value="15">15Ø¯</option>
                                <option value="30" selected>30Ø¯</option>
                                <option value="45">45Ø¯</option>
                                <option value="60">60Ø¯</option>
                                <option value="90">90Ø¯</option>
                                <option value="120">120Ø¯</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row" id="amountRow" style="display: none;">
                        <div class="form-group flex-1">
                            <label>Ø§Ù„Ù…Ø¨Ù„Øº (Ø±.Ø³)</label>
                            <input type="number" class="form-input" id="taskAmount" placeholder="0" inputmode="decimal">
                        </div>
                    </div>
                    <button class="add-btn" onclick="addTask()">+ Ø¥Ø¶Ø§ÙØ©</button>
                </div>

                <button class="next-cat-btn" onclick="nextCategory()">Ø§ÙƒØªÙÙŠØª â†</button>

                <div class="task-summary" id="taskSummary">
                    <div class="summary-header">
                        <h4>Ø§Ù„Ù…Ù‡Ø§Ù…</h4>
                        <span class="task-badge" id="taskCount">0</span>
                    </div>
                    <div class="task-list" id="taskList"></div>
                </div>
            </div>

            <div class="nav-buttons">
                <button class="nav-btn primary" onclick="completePhase1()" id="toPhase2" disabled>Ø§Ù„ØªØ§Ù„ÙŠ â†</button>
            </div>
        </div>

        <!-- PHASE 2 -->
        <div class="phase" id="phase2">
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">ğŸ¯</div>
                    <div>
                        <div class="card-title">Ù…ØµÙÙˆÙØ© Ø£ÙŠØ²Ù†Ù‡Ø§ÙˆØ±</div>
                        <div class="card-subtitle">ØµÙ†Ù‘Ù Ù…Ù‡Ø§Ù…Ùƒ</div>
                    </div>
                </div>

                <div class="matrix-grid">
                    <div class="quadrant q1">
                        <div class="quad-header">
                            <div class="quad-title">
                                <div class="quad-icon">ğŸ”¥</div>
                                <div class="quad-label">
                                    <span class="quad-name">Ø¹Ø§Ø¬Ù„+Ù…Ù‡Ù…</span>
                                    <span class="quad-action">Ø§ÙØ¹Ù„Ù‡ Ø§Ù„Ø¢Ù†</span>
                                </div>
                            </div>
                            <span class="quad-count" id="q1Count">0</span>
                        </div>
                        <div class="quad-tasks" id="q1Tasks"></div>
                    </div>
                    <div class="quadrant q2">
                        <div class="quad-header">
                            <div class="quad-title">
                                <div class="quad-icon">ğŸ“…</div>
                                <div class="quad-label">
                                    <span class="quad-name">Ù…Ù‡Ù…</span>
                                    <span class="quad-action">Ø¬Ø¯ÙˆÙ„ Ù„Ù‡</span>
                                </div>
                            </div>
                            <span class="quad-count" id="q2Count">0</span>
                        </div>
                        <div class="quad-tasks" id="q2Tasks"></div>
                    </div>
                    <div class="quadrant q3">
                        <div class="quad-header">
                            <div class="quad-title">
                                <div class="quad-icon">ğŸ‘¥</div>
                                <div class="quad-label">
                                    <span class="quad-name">Ø¹Ø§Ø¬Ù„</span>
                                    <span class="quad-action">ÙÙˆÙ‘Ø¶Ù‡</span>
                                </div>
                            </div>
                            <span class="quad-count" id="q3Count">0</span>
                        </div>
                        <div class="quad-tasks" id="q3Tasks"></div>
                    </div>
                    <div class="quadrant q4">
                        <div class="quad-header">
                            <div class="quad-title">
                                <div class="quad-icon">ğŸ—‘ï¸</div>
                                <div class="quad-label">
                                    <span class="quad-name">ØºÙŠØ± Ù…Ù‡Ù…</span>
                                    <span class="quad-action">Ø§Ø­Ø°ÙÙ‡</span>
                                </div>
                            </div>
                            <span class="quad-count" id="q4Count">0</span>
                        </div>
                        <div class="quad-tasks" id="q4Tasks"></div>
                    </div>
                </div>
            </div>

            <div class="nav-buttons">
                <button class="nav-btn secondary" onclick="goToPhase(1)">â†’ Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
                <button class="nav-btn primary" onclick="completePhase2()">Ø§Ù„ØªØ§Ù„ÙŠ â†</button>
            </div>
        </div>

        <!-- PHASE 3 -->
        <div class="phase" id="phase3">
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">ğŸ“†</div>
                    <div>
                        <div class="card-title">Ù…ØµÙ…Ù… Ø§Ù„Ø¬Ø¯ÙˆÙ„</div>
                        <div class="card-subtitle">ÙƒØªÙ„ Ø²Ù…Ù†ÙŠØ©</div>
                    </div>
                </div>

                <div id="scheduleSetup">
                    <div class="setup-section">
                        <h4>â° Ø§Ù„Ø«Ø§Ø¨ØªØ©</h4>
                        <div class="event-row">
                            <input type="time" class="form-input time-input" id="eventStart" value="09:00">
                            <span style="color:var(--text-muted)">-</span>
                            <input type="time" class="form-input time-input" id="eventEnd" value="10:00">
                            <input type="text" class="form-input name-input" id="eventName" placeholder="Ø§Ù„Ø§Ø³Ù…">
                            <button class="add-event-btn" onclick="addEvent()">+</button>
                        </div>
                        <div class="event-tags" id="eventTags"></div>
                    </div>

                    <div class="setup-section">
                        <h4>ğŸ”” Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</h4>
                        <div class="notif-row">
                            <label>Ù‚Ø¨Ù„</label>
                            <select id="reminderTime">
                                <option value="5">5Ø¯</option>
                                <option value="10">10Ø¯</option>
                                <option value="15" selected>15Ø¯</option>
                                <option value="30">30Ø¯</option>
                            </select>
                            <label class="toggle-wrapper">
                                <input type="checkbox" id="soundOn" checked>
                                <span class="toggle-track"></span>
                                <span>ØµÙˆØª</span>
                            </label>
                            <button class="test-btn" onclick="testSound()">ğŸ”Š</button>
                        </div>
                    </div>

                    <button class="generate-btn" onclick="generateSchedule()">âœ¨ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¬Ø¯ÙˆÙ„</button>
                </div>

                <div class="schedule-output" id="scheduleOutput">
                    <div class="schedule-header">
                        <h3>ğŸ“‹ Ø¬Ø¯ÙˆÙ„Ùƒ</h3>
                        <div class="schedule-actions">
                            <button class="schedule-btn primary" onclick="copySchedule()">ğŸ“‹</button>
                            <button class="schedule-btn secondary" onclick="regenerate()">ğŸ”„</button>
                        </div>
                    </div>
                    <div class="timeline" id="timeline"></div>
                </div>
            </div>

            <div class="nav-buttons">
                <button class="nav-btn secondary" onclick="goToPhase(2)">â†’ Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
                <button class="nav-btn primary" onclick="startOver()">ğŸ”„ Ø¬Ø¯ÙŠØ¯</button>
            </div>
        </div>
    </div>

    <script>
        // ==================== STATE ====================
        const categories = [
            { id: 'work', name: 'Ø§Ù„Ø¹Ù…Ù„', icon: 'ğŸ’¼', q: 'Ù…Ù‡Ø§Ù… Ø§Ù„Ø¹Ù…Ù„ØŸ', followUp: 'Ø´ÙŠØ¡ Ø¢Ø®Ø±ØŸ', hasAmount: false },
            { id: 'projects', name: 'Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹', icon: 'ğŸš€', q: 'Ù…Ø´Ø§Ø±ÙŠØ¹ÙƒØŸ', followUp: 'Ù…Ø´Ø±ÙˆØ¹ Ø¢Ø®Ø±ØŸ', hasAmount: false },
            { id: 'family', name: 'Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©', icon: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§', q: 'Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©ØŸ', followUp: 'Ø§Ù„ØªØ²Ø§Ù… Ø¢Ø®Ø±ØŸ', hasAmount: false },
            { id: 'financial', name: 'Ø§Ù„Ù…Ø§Ù„ÙŠØ©', icon: 'ğŸ’°', q: 'Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©ØŸ', followUp: 'Ù…Ø§Ù„ÙŠ Ø¢Ø®Ø±ØŸ', hasAmount: true },
            { id: 'growth', name: 'Ø§Ù„ØªØ·ÙˆÙŠØ±', icon: 'ğŸ“š', q: 'ØªØ·ÙˆÙŠØ± Ù†ÙØ³ÙƒØŸ', followUp: 'Ø´ÙŠØ¡ Ø¢Ø®Ø±ØŸ', hasAmount: false }
        ];

        let currentCat = 0;
        let allTasks = [];
        let classified = { q1: [], q2: [], q3: [], q4: [] };
        let fixedEvents = [];
        let schedule = [];
        let notifTimers = [];

        let financialData = { daily: {}, monthly: {}, total: 0 };

        const urgentKW = ['Ø§Ù„ÙŠÙˆÙ…','Ø§Ù„Ø¢Ù†','ÙÙˆØ±Ø§Ù‹','Ø¹Ø§Ø¬Ù„','Ø·Ø§Ø±Ø¦','Ù…ÙˆØ¹Ø¯','Ø§Ø¬ØªÙ…Ø§Ø¹','ØªØ³Ù„ÙŠÙ…','ØºØ¯Ø§Ù‹','Ù‚Ø¨Ù„','Ù„Ø§Ø²Ù…','ÙŠØ¬Ø¨','ÙØ§ØªÙˆØ±Ø©','Ø¯ÙØ¹'];
        const importantKW = ['Ù…Ø´Ø±ÙˆØ¹','Ø¹Ù…Ù„','Ø¹Ù…ÙŠÙ„','Ù…Ø¯ÙŠØ±','ØªÙ‚Ø±ÙŠØ±','Ø®Ø·Ø©','Ù‡Ø¯Ù','ØªØ·ÙˆÙŠØ±','ØµØ­Ø©','Ø¹Ø§Ø¦Ù„Ø©','Ù…Ø§Ù„','Ø§Ø³ØªØ«Ù…Ø§Ø±','Ø±Ø§ØªØ¨','Ø¥ÙŠØ¬Ø§Ø±'];
        const delegateKW = ['Ø¥ÙŠÙ…ÙŠÙ„','Ø±Ø³Ø§Ù„Ø©','Ù…ØªØ§Ø¨Ø¹Ø©','ØªØ°ÙƒÙŠØ±','Ø­Ø¬Ø²','Ø¥Ø±Ø³Ø§Ù„','Ø´Ø±Ø§Ø¡'];
        const eliminateKW = ['ØªØµÙØ­','Ø³ÙˆØ´ÙŠØ§Ù„','ÙŠÙˆØªÙŠÙˆØ¨','Ù…Ø³Ù„Ø³Ù„','Ù„Ø¹Ø¨Ø©','ØªØ±ÙÙŠÙ‡'];

        // ==================== INIT ====================
        function init() {
            loadData();
            const today = new Date();
            document.getElementById('taskDate').valueAsDate = today;
            const monthNames = ['ÙŠÙ†Ø§ÙŠØ±','ÙØ¨Ø±Ø§ÙŠØ±','Ù…Ø§Ø±Ø³','Ø£Ø¨Ø±ÙŠÙ„','Ù…Ø§ÙŠÙˆ','ÙŠÙˆÙ†ÙŠÙˆ','ÙŠÙˆÙ„ÙŠÙˆ','Ø£ØºØ³Ø·Ø³','Ø³Ø¨ØªÙ…Ø¨Ø±','Ø£ÙƒØªÙˆØ¨Ø±','Ù†ÙˆÙÙ…Ø¨Ø±','Ø¯ÙŠØ³Ù…Ø¨Ø±'];
            document.getElementById('monthLabel').textContent = monthNames[today.getMonth()];
            startChat();
            if ('Notification' in window) Notification.requestPermission();
            checkInstallPrompt();
        }

        function checkInstallPrompt() {
            const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
            const dismissed = localStorage.getItem('installDismissed');
            if (!isStandalone && !dismissed && /iPhone|iPad|iPod/.test(navigator.userAgent)) {
                setTimeout(() => document.getElementById('installPrompt').classList.add('show'), 2000);
            }
        }

        function dismissInstall() {
            document.getElementById('installPrompt').classList.remove('show');
            localStorage.setItem('installDismissed', 'true');
        }

        function loadData() {
            const saved = localStorage.getItem('taskManagerData');
            if (saved) {
                const data = JSON.parse(saved);
                financialData = data.financialData || financialData;
            }
            updateFinancialDisplay();
        }

        function saveData() {
            localStorage.setItem('taskManagerData', JSON.stringify({ financialData, lastUpdate: new Date().toISOString() }));
        }

        // ==================== FINANCIAL ====================
        function updateFinancialDisplay() {
            const today = new Date().toISOString().split('T')[0];
            const month = today.substring(0, 7);
            document.getElementById('dailyAmount').textContent = (financialData.daily[today] || 0).toLocaleString('ar-SA');
            document.getElementById('monthlyAmount').textContent = (financialData.monthly[month] || 0).toLocaleString('ar-SA');
            document.getElementById('totalAmount').textContent = financialData.total.toLocaleString('ar-SA');
        }

        function addFinancialAmount(amount, date) {
            if (!amount || amount <= 0) return;
            const dateStr = date || new Date().toISOString().split('T')[0];
            const month = dateStr.substring(0, 7);
            financialData.daily[dateStr] = (financialData.daily[dateStr] || 0) + amount;
            financialData.monthly[month] = (financialData.monthly[month] || 0) + amount;
            financialData.total += amount;
            updateFinancialDisplay();
            saveData();
        }

        // ==================== PHASES ====================
        function goToPhase(n) {
            if (n === 2 && allTasks.length === 0) return;
            if (n === 3 && classified.q1.length === 0 && classified.q2.length === 0) return;
            document.querySelectorAll('.phase').forEach(p => p.classList.remove('active'));
            document.getElementById(`phase${n}`).classList.add('active');
            document.querySelectorAll('.phase-tab').forEach((t, i) => {
                t.classList.remove('active');
                if (i + 1 === n) t.classList.add('active');
            });
        }

        function completePhase1() {
            document.getElementById('tab1').classList.add('completed');
            classifyTasks();
            checkUrgent();
            generateSuggestions();
            goToPhase(2);
        }

        function completePhase2() {
            document.getElementById('tab2').classList.add('completed');
            goToPhase(3);
        }

        // ==================== CHAT ====================
        const chatArea = document.getElementById('chatArea');

        function addBot(text) {
            const msg = document.createElement('div');
            msg.className = 'chat-msg bot';
            msg.innerHTML = `<div class="bot-avatar">ğŸ§ </div><div class="msg-bubble">${text}</div>`;
            chatArea.appendChild(msg);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function addUser(text) {
            const msg = document.createElement('div');
            msg.className = 'chat-msg user';
            msg.innerHTML = `<div class="msg-bubble">${text}</div>`;
            chatArea.appendChild(msg);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function showTyping() {
            const t = document.createElement('div');
            t.className = 'chat-msg bot';
            t.id = 'typing';
            t.innerHTML = `<div class="bot-avatar">ğŸ§ </div><div class="msg-bubble"><div class="typing"><span></span><span></span><span></span></div></div>`;
            chatArea.appendChild(t);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function hideTyping() {
            const t = document.getElementById('typing');
            if (t) t.remove();
        }

        function updateProgress() {
            const dots = document.querySelectorAll('.progress-dot');
            const fill = document.getElementById('progressFill');
            dots.forEach((d, i) => {
                d.classList.remove('active', 'done');
                if (i < currentCat) d.classList.add('done');
                else if (i === currentCat) d.classList.add('active');
            });
            fill.style.width = `${(currentCat / categories.length) * 100}%`;
            document.getElementById('amountRow').style.display = categories[currentCat]?.hasAmount ? 'flex' : 'none';
        }

        function updateTaskList() {
            const summary = document.getElementById('taskSummary');
            const list = document.getElementById('taskList');
            const count = document.getElementById('taskCount');
            if (allTasks.length > 0) {
                summary.classList.add('show');
                count.textContent = allTasks.length;
                list.innerHTML = allTasks.slice(-3).map(t => `
                    <div class="task-item">
                        <div class="task-dot"></div>
                        <div class="task-content">
                            <div class="task-text">${t.text}</div>
                            <div class="task-meta">
                                ${t.time ? `<span>â°${t.time}</span>` : ''}
                                ${t.duration ? `<span>${t.duration}Ø¯</span>` : ''}
                                ${t.amount ? `<span class="amount">${t.amount}Ø±.Ø³</span>` : ''}
                            </div>
                        </div>
                    </div>
                `).join('');
                document.getElementById('toPhase2').disabled = false;
            }
        }

        function addTask() {
            const text = document.getElementById('taskText').value.trim();
            if (!text) return;
            const task = {
                text,
                date: document.getElementById('taskDate').value,
                time: document.getElementById('taskTime').value,
                duration: parseInt(document.getElementById('taskDuration').value),
                amount: parseFloat(document.getElementById('taskAmount').value) || null,
                category: categories[currentCat].id
            };
            allTasks.push(task);
            if (task.amount) addFinancialAmount(task.amount, task.date);
            let display = text;
            if (task.time) display += ` (${task.time})`;
            if (task.duration) display += ` [${task.duration}Ø¯]`;
            if (task.amount) display += ` - ${task.amount}Ø±.Ø³`;
            addUser(display);
            document.getElementById('taskText').value = '';
            document.getElementById('taskTime').value = '';
            document.getElementById('taskAmount').value = '';
            updateTaskList();
            setTimeout(() => { showTyping(); setTimeout(() => { hideTyping(); addBot(categories[currentCat].followUp); }, 300); }, 150);
        }

        function nextCategory() {
            currentCat++;
            if (currentCat >= categories.length) {
                showTyping();
                setTimeout(() => { hideTyping(); addBot('Ù…Ù…ØªØ§Ø²! ğŸ‰ Ø§Ø¶ØºØ· Ø§Ù„ØªØ§Ù„ÙŠ'); }, 300);
                updateProgress();
                return;
            }
            updateProgress();
            setTimeout(() => { showTyping(); setTimeout(() => { hideTyping(); const c = categories[currentCat]; addBot(`${c.icon} ${c.q}`); }, 300); }, 150);
        }

        function startChat() {
            setTimeout(() => {
                addBot('Ù…Ø±Ø­Ø¨Ø§Ù‹! ğŸ‘‹');
                setTimeout(() => { const c = categories[0]; addBot(`${c.icon} ${c.q}`); }, 400);
            }, 200);
        }

        document.getElementById('taskText').addEventListener('keydown', e => { if (e.key === 'Enter') { e.preventDefault(); addTask(); } });

        // ==================== CLASSIFICATION ====================
        function classify(task) {
            const t = task.text.toLowerCase();
            let urg = 0, imp = 0, del = 0, elim = 0;
            const today = new Date().toISOString().split('T')[0];
            if (task.date === today) urg += 3;
            if (task.amount) { imp += 2; if (task.date === today) urg += 2; }
            urgentKW.forEach(k => { if (t.includes(k)) urg += 2; });
            importantKW.forEach(k => { if (t.includes(k)) imp += 2; });
            delegateKW.forEach(k => { if (t.includes(k)) del += 1; });
            eliminateKW.forEach(k => { if (t.includes(k)) elim += 2; });
            if (elim >= 2) return 'q4';
            if (urg >= 2 && imp >= 2) return 'q1';
            if (imp >= 2) return 'q2';
            if (urg >= 2 || del >= 1) return 'q3';
            return 'q2';
        }

        function classifyTasks() {
            classified = { q1: [], q2: [], q3: [], q4: [] };
            allTasks.forEach(t => classified[classify(t)].push(t));
            renderMatrix();
        }

        function renderMatrix() {
            ['q1', 'q2', 'q3', 'q4'].forEach(q => {
                const container = document.getElementById(`${q}Tasks`);
                const count = document.getElementById(`${q}Count`);
                count.textContent = classified[q].length;
                if (classified[q].length === 0) {
                    container.innerHTML = '<div class="empty-quad">Ù„Ø§ ÙŠÙˆØ¬Ø¯</div>';
                } else {
                    container.innerHTML = classified[q].map(t => `
                        <div class="quad-task">
                            <div class="quad-task-text">${t.text}</div>
                            <div class="quad-task-meta">
                                ${t.time ? `<span>â°${t.time}</span>` : ''}
                                ${t.duration ? `<span>${t.duration}Ø¯</span>` : ''}
                                ${t.amount ? `<span class="amount">${t.amount}Ø±.Ø³</span>` : ''}
                            </div>
                        </div>
                    `).join('');
                }
            });
        }

        // ==================== URGENT & SUGGESTIONS ====================
        function checkUrgent() {
            const today = new Date().toISOString().split('T')[0];
            const urgent = classified.q1.filter(t => t.date === today);
            if (urgent.length > 0) {
                document.getElementById('urgentList').innerHTML = urgent.map(t => `
                    <div class="urgent-item">
                        <span class="urgent-time">${t.time || '--:--'}</span>
                        <span class="urgent-text">${t.text}</span>
                    </div>
                `).join('');
                document.getElementById('urgentBanner').classList.add('show');
            }
        }

        function dismissBanner() { document.getElementById('urgentBanner').classList.remove('show'); }

        function generateSuggestions() {
            const suggestions = [];
            const workTasks = allTasks.filter(t => t.category === 'work').length;
            const financialTasks = allTasks.filter(t => t.amount).length;
            if (workTasks > allTasks.length * 0.6) suggestions.push({ icon: 'âš–ï¸', title: 'ØªÙˆØ§Ø²Ù†', desc: 'Ù…Ù‡Ø§Ù… Ø§Ù„Ø¹Ù…Ù„ ÙƒØ«ÙŠØ±Ø©. Ø®ØµØµ ÙˆÙ‚Øª Ù„Ù„Ø¹Ø§Ø¦Ù„Ø©.' });
            if (financialTasks > 3) suggestions.push({ icon: 'ğŸ’µ', title: 'Ø§Ù„Ù…Ø§Ù„', desc: `${financialTasks} Ø§Ù„ØªØ²Ø§Ù…Ø§Øª. ÙÙƒØ± ÙÙŠ Ø§Ù„Ø£ØªÙ…ØªØ©.` });
            if (classified.q1.length > 5) suggestions.push({ icon: 'ğŸš¨', title: 'Ø§Ù„Ø¹Ø§Ø¬Ù„', desc: 'Ù…Ù‡Ø§Ù… Ø¹Ø§Ø¬Ù„Ø© ÙƒØ«ÙŠØ±Ø©. Ø®Ø·Ø· Ù…Ø³Ø¨Ù‚Ø§Ù‹.' });
            if (suggestions.length === 0) suggestions.push({ icon: 'ğŸ¯', title: 'Ù…Ù…ØªØ§Ø²', desc: 'ØªÙ†Ø¸ÙŠÙ…Ùƒ Ø¬ÙŠØ¯!' });
            document.getElementById('suggestionsList').innerHTML = suggestions.slice(0, 2).map(s => `
                <div class="suggestion-item">
                    <span class="suggestion-icon">${s.icon}</span>
                    <div class="suggestion-content">
                        <div class="suggestion-title">${s.title}</div>
                        <div class="suggestion-desc">${s.desc}</div>
                    </div>
                </div>
            `).join('');
            document.getElementById('suggestionsCard').classList.add('show');
        }

        // ==================== TIME BLOCKING ====================
        function addEvent() {
            const start = document.getElementById('eventStart').value;
            const end = document.getElementById('eventEnd').value;
            const name = document.getElementById('eventName').value.trim();
            if (!name) return;
            fixedEvents.push({ start, end, name });
            renderEvents();
            document.getElementById('eventName').value = '';
        }

        function renderEvents() {
            document.getElementById('eventTags').innerHTML = fixedEvents.map((e, i) => `
                <div class="event-tag">${e.start}-${e.end} ${e.name}<button class="remove-tag" onclick="removeEvent(${i})">Ã—</button></div>
            `).join('');
        }

        function removeEvent(i) { fixedEvents.splice(i, 1); renderEvents(); }

        function toMins(time) { const [h, m] = time.split(':').map(Number); return h * 60 + m; }
        function toTime(mins) { const h = Math.floor(mins / 60); const m = mins % 60; return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}`; }

        function generateSchedule() {
            schedule = [];
            const sorted = [...fixedEvents].sort((a, b) => toMins(a.start) - toMins(b.start));
            const urgent = [...classified.q1];
            const important = [...classified.q2];
            let now = 8 * 60, end = 18 * 60, ui = 0, ii = 0, fi = 0;

            while (now < end) {
                if (fi < sorted.length) {
                    const fs = toMins(sorted[fi].start), fe = toMins(sorted[fi].end);
                    if (now >= fs - 15 && now < fe) {
                        if (now < fs) schedule.push({ start: toTime(now), end: sorted[fi].start, title: 'Ø§Ø³ØªØ¹Ø¯Ø§Ø¯', type: 'buffer', duration: fs - now });
                        schedule.push({ start: sorted[fi].start, end: sorted[fi].end, title: sorted[fi].name, type: 'fixed', duration: fe - fs });
                        schedule.push({ start: sorted[fi].end, end: toTime(fe + 15), title: 'Ø§Ø³ØªØ±Ø§Ø­Ø©', type: 'buffer', duration: 15 });
                        now = fe + 15; fi++; continue;
                    }
                }
                if (now >= 12 * 60 && now < 13 * 60 && !schedule.some(s => s.title === 'ØºØ¯Ø§Ø¡')) {
                    schedule.push({ start: '12:00', end: '13:00', title: 'ØºØ¯Ø§Ø¡', type: 'break', duration: 60 });
                    now = 13 * 60; continue;
                }
                if (ui < urgent.length) {
                    const t = urgent[ui], dur = t.duration || 45;
                    schedule.push({ start: toTime(now), end: toTime(now + dur), title: t.text, type: 'urgent', duration: dur, amount: t.amount });
                    ui++; now += dur;
                } else if (ii < important.length) {
                    const t = important[ii], dur = t.duration || 90;
                    schedule.push({ start: toTime(now), end: toTime(now + dur), title: t.text, type: 'deep-work', duration: dur, amount: t.amount });
                    ii++; now += dur;
                    schedule.push({ start: toTime(now), end: toTime(now + 15), title: 'Ø§Ø³ØªØ±Ø§Ø­Ø©', type: 'break', duration: 15 });
                    now += 15;
                } else break;
            }
            schedule.sort((a, b) => toMins(a.start) - toMins(b.start));
            renderSchedule();
            scheduleNotifications();
            document.getElementById('scheduleSetup').style.display = 'none';
            document.getElementById('scheduleOutput').classList.add('show');
        }

        function renderSchedule() {
            document.getElementById('timeline').innerHTML = schedule.map(b => `
                <div class="time-block ${b.type}">
                    <div class="block-time">${b.start}</div>
                    <div class="block-dot"></div>
                    <div class="block-content">
                        <div class="block-title">${b.title}</div>
                        <div class="block-meta"><span>${b.duration}Ø¯</span>${b.amount ? `<span class="amount">${b.amount}Ø±.Ø³</span>` : ''}</div>
                    </div>
                </div>
            `).join('');
        }

        function regenerate() {
            document.getElementById('scheduleOutput').classList.remove('show');
            document.getElementById('scheduleSetup').style.display = 'block';
        }

        // ==================== NOTIFICATIONS ====================
        let audioCtx = null;
        function playSound() {
            if (!document.getElementById('soundOn').checked) return;
            try {
                if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                const osc = audioCtx.createOscillator(), gain = audioCtx.createGain();
                osc.connect(gain); gain.connect(audioCtx.destination);
                osc.frequency.setValueAtTime(800, audioCtx.currentTime);
                osc.frequency.setValueAtTime(600, audioCtx.currentTime + 0.1);
                gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                osc.start(); osc.stop(audioCtx.currentTime + 0.3);
            } catch (e) {}
        }
        function testSound() { playSound(); }
        function showNotif(title, body) {
            document.getElementById('notifTitle').textContent = title;
            document.getElementById('notifBody').textContent = body;
            document.getElementById('notifPopup').classList.add('show');
            playSound();
            setTimeout(hideNotif, 6000);
            if ('Notification' in window && Notification.permission === 'granted') new Notification(title, { body });
        }
        function hideNotif() { document.getElementById('notifPopup').classList.remove('show'); }
        function scheduleNotifications() {
            notifTimers.forEach(t => clearTimeout(t)); notifTimers = [];
            const mins = parseInt(document.getElementById('reminderTime').value), now = new Date();
            schedule.forEach(b => {
                if (b.type === 'buffer' || b.type === 'break') return;
                const [h, m] = b.start.split(':').map(Number);
                const taskTime = new Date(); taskTime.setHours(h, m, 0, 0);
                if (taskTime < now) taskTime.setDate(taskTime.getDate() + 1);
                const notifyAt = new Date(taskTime.getTime() - mins * 60000);
                const delay = notifyAt.getTime() - now.getTime();
                if (delay > 0) notifTimers.push(setTimeout(() => showNotif(`â° Ø¨Ø¹Ø¯ ${mins}Ø¯`, b.title), delay));
            });
        }

        // ==================== EXPORT ====================
        function openExportModal() { document.getElementById('exportModal').classList.add('show'); }
        function closeExportModal() { document.getElementById('exportModal').classList.remove('show'); }
        function closeModal(e) { if (e.target === e.currentTarget) closeExportModal(); }

        function exportFinancialCSV() {
            let csv = '\ufeffØ§Ù„ØªØ§Ø±ÙŠØ®,Ø§Ù„Ù…Ù‡Ù…Ø©,Ø§Ù„Ù…Ø¨Ù„Øº\n';
            allTasks.filter(t => t.amount).forEach(t => csv += `${t.date || ''},${t.text},${t.amount}\n`);
            const today = new Date().toISOString().split('T')[0], month = today.substring(0, 7);
            csv += `\nØ§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙŠÙˆÙ…ÙŠ,${today},${financialData.daily[today] || 0}\n`;
            csv += `Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø´Ù‡Ø±ÙŠ,${month},${financialData.monthly[month] || 0}\n`;
            csv += `Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ,,${financialData.total}\n`;
            downloadFile(csv, 'financial.csv', 'text/csv;charset=utf-8');
            closeExportModal();
        }

        function exportScheduleText() {
            let text = 'ğŸ“† Ø§Ù„Ø¬Ø¯ÙˆÙ„\n' + 'â•'.repeat(20) + '\n\n';
            schedule.forEach(b => { text += `${b.start} | ${b.title}\n`; });
            copyText(text);
            closeExportModal();
        }

        function exportFullReport() {
            const today = new Date().toISOString().split('T')[0], month = today.substring(0, 7);
            let text = `ğŸ“‹ ØªÙ‚Ø±ÙŠØ± ${today}\n${'â•'.repeat(20)}\n\n`;
            text += `ğŸ’° Ø§Ù„Ù…Ø§Ù„ÙŠ:\nâ€¢ Ø§Ù„ÙŠÙˆÙ…: ${financialData.daily[today] || 0}Ø±.Ø³\nâ€¢ Ø§Ù„Ø´Ù‡Ø±: ${financialData.monthly[month] || 0}Ø±.Ø³\nâ€¢ Ø§Ù„ÙƒÙ„ÙŠ: ${financialData.total}Ø±.Ø³\n\n`;
            text += 'ğŸ”¥ Ø¹Ø§Ø¬Ù„:\n'; classified.q1.forEach(t => text += `â€¢ ${t.text}\n`);
            text += '\nğŸ“… Ù…Ù‡Ù…:\n'; classified.q2.forEach(t => text += `â€¢ ${t.text}\n`);
            copyText(text);
            closeExportModal();
        }

        async function shareReport() {
            const today = new Date().toISOString().split('T')[0];
            const text = `ğŸ“‹ ØªÙ‚Ø±ÙŠØ± ${today}\nğŸ’° Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙŠÙˆÙ…: ${financialData.daily[today] || 0}Ø±.Ø³\nğŸ”¥ Ù…Ù‡Ø§Ù… Ø¹Ø§Ø¬Ù„Ø©: ${classified.q1.length}`;
            if (navigator.share) {
                try { await navigator.share({ title: 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ù‡Ø§Ù…', text }); } catch (e) {}
            } else {
                copyText(text);
            }
            closeExportModal();
        }

        function copyText(text) {
            navigator.clipboard.writeText(text).then(() => alert('ØªÙ… Ø§Ù„Ù†Ø³Ø®!'));
        }

        function downloadFile(content, filename, type) {
            const blob = new Blob([content], { type });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url; a.download = filename; a.click();
            URL.revokeObjectURL(url);
        }

        function copySchedule() { exportScheduleText(); }

        // ==================== RESET ====================
        function startOver() {
            currentCat = 0; allTasks = []; classified = { q1: [], q2: [], q3: [], q4: [] };
            fixedEvents = []; schedule = [];
            notifTimers.forEach(t => clearTimeout(t));
            document.querySelectorAll('.phase-tab').forEach(t => t.classList.remove('active', 'completed'));
            document.getElementById('tab1').classList.add('active');
            document.querySelectorAll('.phase').forEach(p => p.classList.remove('active'));
            document.getElementById('phase1').classList.add('active');
            chatArea.innerHTML = '';
            document.getElementById('taskSummary').classList.remove('show');
            document.getElementById('toPhase2').disabled = true;
            document.getElementById('progressFill').style.width = '0%';
            document.querySelectorAll('.progress-dot').forEach((d, i) => {
                d.classList.remove('active', 'done');
                if (i === 0) d.classList.add('active');
            });
            document.getElementById('scheduleOutput').classList.remove('show');
            document.getElementById('scheduleSetup').style.display = 'block';
            document.getElementById('eventTags').innerHTML = '';
            document.getElementById('urgentBanner').classList.remove('show');
            document.getElementById('suggestionsCard').classList.remove('show');
            document.getElementById('amountRow').style.display = 'none';
            startChat();
        }

        init();
    </script>
</body>
</html>
